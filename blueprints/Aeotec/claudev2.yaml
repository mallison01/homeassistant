blueprint:
  name: Aeotec Indoor Siren 6 (ZW164) Security & Environmental Monitor
  description: |
    Comprehensive automation for Aeotec Indoor Siren 6 with multiple trigger options.
    Supports door/window sensors, temperature/humidity monitoring, customizable tones,
    light effects, and time-based conditions.
  domain: automation
  input:
    # Device Selection
    siren_device:
      name: Aeotec Indoor Siren 6
      description: Select your Aeotec Indoor Siren 6 device
      selector:
        device:
          integration: zwave_js
          manufacturer: Aeotec Ltd.
          model: ZW164
    
    # Time Conditions
    enable_time_conditions:
      name: Enable Time Conditions
      description: Check to enable time-based restrictions
      default: false
      selector:
        boolean:
    
    time_start:
      name: Start Time
      description: Siren will only activate after this time
      default: "22:00:00"
      selector:
        time:
    
    time_end:
      name: End Time
      description: Siren will only activate before this time
      default: "06:00:00"
      selector:
        time:
    
    # Door Sensor Configuration
    enable_door_sensor:
      name: Enable Door Sensor
      description: Enable door sensor monitoring
      default: false
      selector:
        boolean:
    
    door_sensor:
      name: Door Sensor
      description: Select door sensor entity
      default: []
      selector:
        entity:
          domain: binary_sensor
          device_class: door
    
    # Window Sensor Configuration
    enable_window_sensor:
      name: Enable Window Sensor
      description: Enable window sensor monitoring
      default: false
      selector:
        boolean:
    
    window_sensor:
      name: Window Sensor
      description: Select window sensor entity
      default: []
      selector:
        entity:
          domain: binary_sensor
          device_class: window
    
    # Temperature Sensor Configuration
    enable_temperature_sensor:
      name: Enable Temperature Monitoring
      description: Enable temperature threshold monitoring
      default: false
      selector:
        boolean:
    
    temperature_sensor:
      name: Temperature Sensor
      description: Select temperature sensor entity
      default: []
      selector:
        entity:
          domain: sensor
          device_class: temperature
    
    temperature_unit:
      name: Temperature Unit
      description: Select temperature unit
      default: celsius
      selector:
        select:
          options:
            - celsius
            - fahrenheit
    
    temperature_threshold:
      name: Temperature Threshold
      description: Temperature threshold to trigger siren
      default: 30
      selector:
        number:
          min: -40
          max: 100
          step: 0.5
          unit_of_measurement: "Â°"
    
    temperature_condition:
      name: Temperature Condition
      description: Trigger when temperature is above or below threshold
      default: above
      selector:
        select:
          options:
            - above
            - below
    
    # Humidity Sensor Configuration
    enable_humidity_sensor:
      name: Enable Humidity Monitoring
      description: Enable humidity threshold monitoring
      default: false
      selector:
        boolean:
    
    humidity_sensor:
      name: Humidity Sensor
      description: Select humidity sensor entity
      default: []
      selector:
        entity:
          domain: sensor
          device_class: humidity
    
    humidity_threshold:
      name: Humidity Threshold
      description: Humidity threshold to trigger siren (%)
      default: 70
      selector:
        number:
          min: 0
          max: 100
          step: 1
          unit_of_measurement: "%"
    
    humidity_condition:
      name: Humidity Condition
      description: Trigger when humidity is above or below threshold
      default: above
      selector:
        select:
          options:
            - above
            - below
    
    # Siren Configuration
    siren_tone:
      name: Siren Tone
      description: Select the siren tone
      default: "1"
      selector:
        select:
          options:
            - "1"
            - "2"
            - "3"
            - "4"
            - "5"
            - "6"
            - "7"
            - "8"
            - "9"
            - "10"
            - "11"
            - "12"
            - "13"
            - "14"
            - "15"
            - "16"
            - "17"
            - "18"
            - "19"
            - "20"
            - "21"
            - "22"
            - "23"
            - "24"
            - "25"
            - "26"
            - "27"
            - "28"
            - "29"
            - "30"
    
    siren_volume:
      name: Siren Volume
      description: Volume level (0-100%)
      default: 80
      selector:
        number:
          min: 0
          max: 100
          step: 5
          unit_of_measurement: "%"
    
    siren_duration:
      name: Siren Duration
      description: Duration in seconds (1-600 seconds)
      default: 10
      selector:
        number:
          min: 1
          max: 600
          step: 1
          unit_of_measurement: "sec"
    
    # Light Effect Configuration
    light_effect:
      name: Light Effect
      description: Select the light effect
      default: "0"
      selector:
        select:
          options:
            - "0"
            - "1"
            - "2"
            - "3"
            - "4"
            - "5"
    
    light_color:
      name: Light Color
      description: Select the light color
      default: "1"
      selector:
        select:
          options:
            - value: "1"
              label: "1 - Red"
            - value: "2"
              label: "2 - Orange"
            - value: "3"
              label: "3 - Yellow"
            - value: "4"
              label: "4 - Green"
            - value: "5"
              label: "5 - Blue"
            - value: "6"
              label: "6 - Indigo"
            - value: "7"
              label: "7 - Violet"

variables:
  door_enabled: !input enable_door_sensor
  window_enabled: !input enable_window_sensor
  temp_enabled: !input enable_temperature_sensor
  humidity_enabled: !input enable_humidity_sensor
  time_enabled: !input enable_time_conditions
  temp_unit: !input temperature_unit
  temp_condition: !input temperature_condition
  humidity_condition: !input humidity_condition

trigger:
  - platform: state
    entity_id: !input door_sensor
    to: 'on'
    id: door_opened
    enabled: "{{ door_enabled }}"
  
  - platform: state
    entity_id: !input window_sensor
    to: 'on'
    id: window_opened
    enabled: "{{ window_enabled }}"
  
  - platform: numeric_state
    entity_id: !input temperature_sensor
    above: !input temperature_threshold
    id: temp_above
    enabled: "{{ temp_enabled and temp_condition == 'above' }}"
  
  - platform: numeric_state
    entity_id: !input temperature_sensor
    below: !input temperature_threshold
    id: temp_below
    enabled: "{{ temp_enabled and temp_condition == 'below' }}"
  
  - platform: numeric_state
    entity_id: !input humidity_sensor
    above: !input humidity_threshold
    id: humidity_above
    enabled: "{{ humidity_enabled and humidity_condition == 'above' }}"
  
  - platform: numeric_state
    entity_id: !input humidity_sensor
    below: !input humidity_threshold
    id: humidity_below
    enabled: "{{ humidity_enabled and humidity_condition == 'below' }}"

condition:
  - condition: or
    conditions:
      - condition: template
        value_template: "{{ not time_enabled }}"
      - condition: and
        conditions:
          - condition: template
            value_template: "{{ time_enabled }}"
          - condition: time
            after: !input time_start
            before: !input time_end

action:
  - service: zwave_js.set_config_parameter
    target:
      device_id: !input siren_device
    data:
      parameter: 37
      value: "{{ siren_tone | int }}"
    variables:
      siren_tone: !input siren_tone
  
  - service: zwave_js.set_config_parameter
    target:
      device_id: !input siren_device
    data:
      parameter: 38
      value: !input siren_volume
  
  - service: zwave_js.set_config_parameter
    target:
      device_id: !input siren_device
    data:
      parameter: 39
      value: !input siren_duration
  
  - service: zwave_js.set_config_parameter
    target:
      device_id: !input siren_device
    data:
      parameter: 40
      value: "{{ light_effect | int }}"
    variables:
      light_effect: !input light_effect
  
  - service: zwave_js.set_config_parameter
    target:
      device_id: !input siren_device
    data:
      parameter: 41
      value: "{{ light_color | int }}"
    variables:
      light_color: !input light_color
  
  - service: switch.turn_on
    target:
      device_id: !input siren_device

mode: single
max_exceeded: silent
