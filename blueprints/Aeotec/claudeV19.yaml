blueprint:
  name: Aeotec Indoor Siren 6 (ZW164) Security & Environmental Monitor
  description: |
    Comprehensive automation for Aeotec Indoor Siren 6 with multiple trigger options.
    Supports door/window sensors, temperature/humidity monitoring, customizable tones,
    light effects, and time-based conditions using proper Z-Wave JS Sound Switch commands.
  domain: automation
  input:
    # Device Selection
    siren_device:
      name: Aeotec Indoor Siren 6
      description: Select your Aeotec Indoor Siren 6 device
      selector:
        device:
          integration: zwave_js
          manufacturer: Aeotec Ltd.
          model: ZW164
    
    # Time Conditions
    enable_time_conditions:
      name: Enable Time Conditions
      description: Check to enable time-based restrictions
      default: false
      selector:
        boolean:
    
    time_start:
      name: Start Time
      description: Siren will only activate after this time
      default: "22:00:00"
      selector:
        time:
    
    time_end:
      name: End Time
      description: Siren will only activate before this time
      default: "06:00:00"
      selector:
        time:
    
    # Door Sensor Configuration
    enable_door_sensor:
      name: Enable Door Sensor
      description: Enable door sensor monitoring
      default: false
      selector:
        boolean:
    
    door_sensor:
      name: Door Sensor
      description: Select door sensor entity
      default: []
      selector:
        entity:
          domain: binary_sensor
          device_class: door
    
    # Window Sensor Configuration
    enable_window_sensor:
      name: Enable Window Sensor
      description: Enable window sensor monitoring
      default: false
      selector:
        boolean:
    
    window_sensor:
      name: Window Sensor
      description: Select window sensor entity
      default: []
      selector:
        entity:
          domain: binary_sensor
          device_class: window
    
    # Temperature Sensor Configuration
    enable_temperature_sensor:
      name: Enable Temperature Monitoring
      description: Enable temperature threshold monitoring
      default: false
      selector:
        boolean:
    
    temperature_sensor:
      name: Temperature Sensor
      description: Select temperature sensor entity
      default: []
      selector:
        entity:
          domain: sensor
          device_class: temperature
    
    temperature_unit:
      name: Temperature Unit
      description: Select temperature unit
      default: celsius
      selector:
        select:
          options:
            - value: celsius
              label: "Celsius (°C)"
            - value: fahrenheit
              label: "Fahrenheit (°F)"
    
    temperature_threshold:
      name: Temperature Threshold
      description: Temperature threshold to trigger siren
      default: 30
      selector:
        number:
          min: -40
          max: 100
          step: 0.5
          unit_of_measurement: "°"
    
    temperature_condition:
      name: Temperature Condition
      description: Trigger when temperature is above or below threshold
      default: above
      selector:
        select:
          options:
            - value: above
              label: "Above threshold"
            - value: below
              label: "Below threshold"
    
    # Humidity Sensor Configuration
    enable_humidity_sensor:
      name: Enable Humidity Monitoring
      description: Enable humidity threshold monitoring
      default: false
      selector:
        boolean:
    
    humidity_sensor:
      name: Humidity Sensor
      description: Select humidity sensor entity
      default: []
      selector:
        entity:
          domain: sensor
          device_class: humidity
    
    humidity_threshold:
      name: Humidity Threshold
      description: Humidity threshold to trigger siren (%)
      default: 70
      selector:
        number:
          min: 0
          max: 100
          step: 1
          unit_of_measurement: "%"
    
    humidity_condition:
      name: Humidity Condition
      description: Trigger when humidity is above or below threshold
      default: above
      selector:
        select:
          options:
            - value: above
              label: "Above threshold"
            - value: below
              label: "Below threshold"
    
    # Siren Configuration
    siren_tone:
      name: Siren Tone
      description: Select the siren tone (1-30)
      default: "1"
      selector:
        select:
          options:
            - value: "1"
              label: "1 - Ding Dong"
            - value: "2"
              label: "2 - Ding Dong Ding"
            - value: "3"
              label: "3 - Traditional Door Chime"
            - value: "4"
              label: "4 - Police Siren"
            - value: "5"
              label: "5 - Evacuation"
            - value: "6"
              label: "6 - Beep Beep"
            - value: "7"
              label: "7 - Beep"
            - value: "8"
              label: "8 - Ding"
            - value: "9"
              label: "9 - Dong"
            - value: "10"
              label: "10 - Hee Haw"
            - value: "11"
              label: "11 - Hallelujah"
            - value: "12"
              label: "12 - Hush Little Baby"
            - value: "13"
              label: "13 - Jingle Bells"
            - value: "14"
              label: "14 - Mary Had a Little Lamb"
            - value: "15"
              label: "15 - Westminster Chimes"
            - value: "16"
              label: "16 - Traditional Cuckoo"
            - value: "17"
              label: "17 - Intermittent Alarm"
            - value: "18"
              label: "18 - Continuous Alarm"
            - value: "19"
              label: "19 - Emergency Sound"
            - value: "20"
              label: "20 - Clock Alarm"
            - value: "21"
              label: "21 - Fire Alarm"
            - value: "22"
              label: "22 - Ambulance"
            - value: "23"
              label: "23 - Police Car"
            - value: "24"
              label: "24 - Door Chime Extended"
            - value: "25"
              label: "25 - Arm/Disarm Beep"
            - value: "26"
              label: "26 - Telephone Ring"
            - value: "27"
              label: "27 - Smoke Alarm"
            - value: "28"
              label: "28 - CO Alarm"
            - value: "29"
              label: "29 - Test Alarm"
            - value: "30"
              label: "30 - Wakeup"
    
    siren_volume:
      name: Siren Volume
      description: Volume level (0-100)
      default: 80
      selector:
        number:
          min: 0
          max: 100
          step: 5
          unit_of_measurement: "%"
    
    # Light Effect Configuration
    light_effect:
      name: Light Effect
      description: Select the light effect
      default: "1"
      selector:
        select:
          options:
            - value: "1"
              label: "1 - Breathing (Default)"
            - value: "2"
              label: "2 - Slow Blink"
            - value: "4"
              label: "3 - Fast Flash"
            - value: "8"
              label: "4 - Quick Flash"
            - value: "16"
              label: "5 - Solid"
            - value: "32"
              label: "6 - Slow Fade"
            - value: "64"
              label: "7 - Strobe"
    
    # Application Type
    application_type:
      name: Application Type
      description: Choose the application context for different trigger behaviors
      default: security
      selector:
        select:
          options:
            - value: security
              label: "Security (Endpoint 7) - For intrusion/break-in alerts"
            - value: environment
              label: "Environment (Endpoint 6) - For smoke/gas/water alarms"
            - value: emergency
              label: "Emergency (Endpoint 8) - For emergency situations"
            - value: browse
              label: "Browse (Endpoint 1) - For testing/general use"

variables:
  door_enabled: !input enable_door_sensor
  window_enabled: !input enable_window_sensor
  temp_enabled: !input enable_temperature_sensor
  humidity_enabled: !input enable_humidity_sensor
  time_enabled: !input enable_time_conditions
  temp_unit: !input temperature_unit
  temp_condition: !input temperature_condition
  humidity_condition: !input humidity_condition
  app_type: !input application_type
  endpoint_map:
    security: 7
    environment: 6
    emergency: 8
    browse: 1

trigger:
  - platform: state
    entity_id: !input door_sensor
    to: 'on'
    id: door_opened
    enabled: "{{ door_enabled }}"
  
  - platform: state
    entity_id: !input window_sensor
    to: 'on'
    id: window_opened
    enabled: "{{ window_enabled }}"
  
  - platform: numeric_state
    entity_id: !input temperature_sensor
    above: !input temperature_threshold
    id: temp_above
    enabled: "{{ temp_enabled and temp_condition == 'above' }}"
  
  - platform: numeric_state
    entity_id: !input temperature_sensor
    below: !input temperature_threshold
    id: temp_below
    enabled: "{{ temp_enabled and temp_condition == 'below' }}"
  
  - platform: numeric_state
    entity_id: !input humidity_sensor
    above: !input humidity_threshold
    id: humidity_above
    enabled: "{{ humidity_enabled and humidity_condition == 'above' }}"
  
  - platform: numeric_state
    entity_id: !input humidity_sensor
    below: !input humidity_threshold
    id: humidity_below
    enabled: "{{ humidity_enabled and humidity_condition == 'below' }}"

condition:
  - condition: or
    conditions:
      - condition: template
        value_template: "{{ not time_enabled }}"
      - condition: and
        conditions:
          - condition: template
            value_template: "{{ time_enabled }}"
          - condition: time
            after: !input time_start
            before: !input time_end

action:
  # Configure Light Effect for selected endpoint
  - service: zwave_js.set_config_parameter
    target:
      device_id: !input siren_device
    data:
      parameter: >
        {% if app_type == 'security' %}
          7
        {% elif app_type == 'environment' %}
          6  
        {% elif app_type == 'emergency' %}
          8
        {% else %}
          1
        {% endif %}
      value: "{{ (light_effect | int) * 16777216 }}"
    variables:
      light_effect: !input light_effect
      app_type: !input application_type
  
  # Turn on the siren (basic activation)
  - service: switch.turn_on
    target:
      device_id: !input siren_device

mode: single
max_exceeded: silent
