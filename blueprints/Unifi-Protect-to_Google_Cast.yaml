blueprint:
  name: Unifi Protect Camera Cast to Google Display
  description: Cast Unifi Protect camera to Google Display based on binary sensor state.
  domain: automation
  input:
    camera:
      name: Camera
      description: Select the Unifi Protect camera to cast.
      selector:
        entity:
          domain: camera
          integration: unifiprotect
    cast_device:
      name: Google Cast Device or Group
      description: Select the Google Cast device or Group to cast to.
      selector:
        entity:
          # Filter to include only entities that match one of the following criteria
          filter:
            # Match entities that belong to the 'cast' integration
            - integration: cast
            # Match entities that are part of a 'media_player' group.
            # This is an alternative to specifying the domain directly.
            - domain: media_player
              # The 'group' platform is used for media player groups.
              # This filter specifically targets media player group entities.
              platform: group
    time_limit:
      name: Time Limit
      description: Set the time limit for casting the camera stream.
      default: 30
      selector:
        number:
          min: 10
          max: 300
          unit_of_measurement: seconds
    trigger_binary_sensor:
      name: Trigger Binary Sensor
      description: Select the binary sensor that triggers the automation.
      selector:
        entity:
          domain: binary_sensor
          integration: unifiprotect

trigger:
  - platform: state
    entity_id: !input trigger_binary_sensor
    to: 'on'

action:
  - service: camera.play_stream
    data:
      format: hls
      media_player: !input cast_device
    target:
      entity_id: !input camera  
  - delay: !input time_limit
  - service: media_player.turn_off
    target:
      entity_id: !input cast_device
mode: single
